<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Gamedev Canvas Workshop</title>
  <style>
  * { padding: 0; margin: 0; }
  canvas { background: #eee; display: block; margin: 0 auto; }
  </style>
</head>
<body>
  <canvas id="myCanvas" width="500" height="350"></canvas>
  <script>
  var canvas = document.getElementById('myCanvas');
  var context = canvas.getContext('2d');

  var speed = 10;
  gameSpeed = 10;
  var bird = {
    x : 40,
    y : 100,
    vx : 0,
    vy : 1
  };

  var pips = [];

  var gravity = 0.2;
  var bounce = 4;

  var dir = 'left';

  document.onkeydown = function(e){
    if(!e){
      e = window.e;
    }
    var code = e.keyCode;
    if(e.charCode && codee ==0){
      code = e.charCode;
    }
    switch (code) {
      case 37://left
        if(dir != 'right')
          dir = 'left';
        break;
      case 38:
        if(dir != 'down')
        dir = 'up';
        break;
      case 39:
        if(dir != 'left')
        dir = 'right';
        break;
      case 40:
        if(dir != 'up')
        dir = 'down';
        break;

    }
  }

var b = 0.8;
function makeBird() {
  context.beginPath();
  context.rect(bird.x, bird.y ,10,10);
  context.fillStyle = "red";
  context.fill();
  context.closePath();

  bird.y += bird.vy;
  bird.vy += gravity;
  // if(bird.y + 10 >= canvas.height){
  if(dir=='up'){
    bird.vy = -bounce;
    dir = '';
  }

  if(bird.y + 10 >= canvas.height){
    console.log('You fucked');
    dir = 'up';
  }
}

function makePip() {
  for (pip of pips) {

    pip.top.height = rnd(50,100);
    



    context.beginPath();
    context.rect(pip.top.x, pip.top.y,pip.top.width, pip.top.height);
    context.fillStyle = 'blue';
    context.fill();
    context.closePath();
    context.beginPath();
    context.rect(pip.bottom.x ,pip.bottom.y,pip.bottom.width,pip.bottom.height);
    context.fillStyle = 'yellow';
    context.fill();
    context.closePath();


    pip.top.x -= 1;
  }

}

function isCollide(a,b) {
    return (
      (b.x == a.x) &&
      (b.y == a.y)
    );
}


function rnd(min, max) {
  var r = Math.round(Math.random() * (max - min) + min);
  return (r - r % speed);
}


 var frame = 0;
(function loop(){
  requestAnimationFrame(function () {
    context.clearRect(0 , 0, canvas.width, canvas.height);
    makeBird();
    makePip();
    if(frame % gameSpeed == 0 ){
      pips.push({
        top : {
          x : canvas.width - 20,
          y : 0,
          height : 0,
          width : 10
        },
        bottom : {
          x : canvas.width - 20,
          y : 0,
          height : 0,
          width : 10
        }
      })
    }
    frame++;
    loop();
  })
})();
</script>
</body>
</html>
